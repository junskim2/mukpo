<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

<!-- 회원가입 sql -->
<insert id="userInsert" parameterType="userVO"> 
	INSERT INTO member VALUES(#{mId}, #{mPw}, #{mName}, #{mTel}, #{mBorn},#{mEmail})	
</insert>

<!-- 로그인 sql -->
<select id="userLogin" parameterType="userVO" resultType="userVO"> 
	select * from member where m_id=#{mId} 
	<if test="mPw !=null">
		AND m_pw = #{mPw}
	</if>
	
</select>

	<!-- 리뷰 등록sql -->
	<insert id="reviewInsert" parameterType="reVO">
		INSERT INTO review VALUES(#{rId},#{rvContent},sysdate)
	</insert>

	<!-- 마이페이지 포인트내역 -->
	<select id="selectPoint" parameterType="poVO" resultType="poVO">
		SELECT * FROM point WHERE m_id = '${mId}'

	</select>

	<!-- 마이페이지 날짜검색 포인트내역 -->
	<select id="selectPointDate" parameterType="poVO" resultType="poVO">
		SELECT * FROM point WHERE m_id = '${mId}' AND p_date BETWEEN TO_DATE('${startDate}', 'yyyy/mm/dd') AND TO_DATE('${endDate}', 'yyyy/mm/dd')
	</select>
	
	<!-- 마이페이지 먹포인트 충전 메인 -->
	<select id="selectPointCharge" parameterType="poVO" resultType="poVO">
		SELECT * FROM (SELECT * FROM point WHERE m_id='${mId}' ORDER BY p_date DESC) WHERE rownum=1 
	</select>
	
	<!-- 회원명 검색 -->
	<select id="selectMemberName" parameterType="userVO" resultType="userVO">
		SELECT * FROM member WHERE m_id = #{mId}
	</select>
	
	<!-- 먹포인트 충전 -->
	<insert id="insertPoint" parameterType="poVO">
		INSERT INTO point (p_id, m_id, p_date, p_as, p_store, p_price, p_cruntmoney) VALUES (seq_point_p_id.nextval, #{mId}, sysdate, '충전', '포인트충전', #{pPrice}, #{pCruntmoney})
	</insert>
	
	<!-- 마이페이지 주간예약 매장 검색 -->
<!-- 마이페이지 주간예약 매장 검색 -->
<select id="getaddr" parameterType="java.util.HashMap" resultType="storeVO">
               SELECT s_name
               FROM store
               WHERE s_name like '%'||'${search}'||'%' 
               or s_sido like '%'||'${search}'||'%'
               or s_sigungu like '%'||'${search}'||'%'
               or s_cate like '%'||'${search}'||'%'
</select>

	<!-- 생생리뷰 -->
<!-- 	<select id="selectLatelyReview" parameterType="java.util.HashMap" resultType="java.util.HashMap"> -->
<!-- 		SELECT c.rv_content AS rv_content, c.rv_date AS rv_date, c.r_cid AS r_cid, c.s_name AS s_name, c.m_name AS m_name -->
<!-- 		FROM (SELECT a.rv_content AS rv_content, a.rv_date AS rv_date, b.r_cid AS r_cid, b.s_name AS s_name, d.m_name AS m_name -->
<!-- 				FROM review a, -->
<!-- 		        (SELECT r_id, r_cid, s_name FROM reservelist WHERE r_mpwp = '${rMpwp}') b, -->
<!-- 		        (SELECT m_name FROM member WHERE m_id IN (SELECT m_id FROM reservelist) ) d -->
<!-- 				WHERE a.r_id IN b.r_id -->
<!-- 				ORDER BY rv_date DESC) c -->
<!-- 		<where> -->
<!-- 			ROWNUM <![CDATA[ <= ]]> 6; -->
<!-- 		</where> -->
<!-- 	</select> -->

</mapper>